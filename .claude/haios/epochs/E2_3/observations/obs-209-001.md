# generated: 2026-01-19
# System Auto: last updated on: 2026-01-19T18:01:43
# Observation: get_queue() Not Respecting FIFO Order

id: obs-209-001
session: 209
date: 2026-01-19
memory_refs: []
triage_status: resolved
potential_action: bugfix
resolved_session: 211
resolved_by: Session 211 bugfix

---

## What

`WorkEngine.get_queue()` returns items in priority order, not FIFO order as specified in work_queues.yaml.

## Evidence

```yaml
# work_queues.yaml
workitem-evolution:
  type: fifo  # Should be creation_date ASC
  items:
    - WORK-001  # Listed first
    - E2-179    # Listed second
```

```
# just queue workitem-evolution output
Queue: workitem-evolution (2 items)
  1. E2-179: Scaffold Recipe Optional Frontmatter Args (priority=medium)  # Wrong!
  2. WORK-001: Implement Universal Work Item Structure (priority=critical)
```

WORK-001 should be first (FIFO), but E2-179 appears first (priority ordering leak).

## Why It Matters

Queue type defines execution strategy. FIFO queues are for sequential dependencies where order matters. If get_queue() ignores queue type, the ordering contract is broken.

## Potential Fix

`WorkEngine.get_queue()` needs to check queue type from work_queues.yaml and apply appropriate ordering:
- `fifo`: Return in YAML list order (or creation_date ASC)
- `priority`: Return sorted by priority DESC

---

## Resolution (Session 211)

Fixed two bugs in `get_queue()`:

1. **Bug 1: Completed items not filtered** - When `q.items` is an explicit list (not "auto"), completed items were returned. Fixed by applying terminal status filter to explicit lists.

2. **Bug 2: FIFO ordering ignored YAML order** - For explicit item lists, the code sorted by creation date instead of preserving YAML order. Fixed by only sorting auto lists; explicit lists preserve iteration order.

**Files changed:**
- `.claude/haios/modules/work_engine.py` (lines 345-398)
- `tests/test_work_queues.py` (added 3 tests)

**Verification:**
- After fix: `just queue workitem-evolution` returns 1 item (E2-179) with WORK-001 filtered out
- All 11 queue tests pass, all 27 work engine tests pass

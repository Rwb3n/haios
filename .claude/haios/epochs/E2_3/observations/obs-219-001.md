# generated: 2026-01-21
# System Auto: last updated on: 2026-01-21T19:14:46
# Observation: .claude/lib Migration Required for Portability

id: obs-219-001
session: 219
date: 2026-01-21
priority: high
dimension: architecture

---

## What

`.claude/lib/` contains 23 Python modules that live outside the portable plugin directory (`.claude/haios/`). New code like `loader.py` should go in `.claude/haios/lib/` for portability, but this creates drift - two lib directories with unclear boundaries.

## Why It Matters

**Portability test:** "Can you drop `.claude/haios/` into a fresh workspace and have it work?"

Currently: **No.** The plugin depends on `.claude/lib/` which is outside the portable directory.

If we build new infrastructure in `.claude/haios/lib/` while old infrastructure stays in `.claude/lib/`, we get:
- Import path confusion (which lib?)
- Incomplete portability (plugin needs external deps)
- Gradual drift between old and new

## Evidence

- `.claude/lib/` has 23 files (database.py, scaffold.py, work_item.py, etc.)
- `.claude/haios/modules/` imports from `.claude/lib/` (external dependency)
- WORK-005 plan corrected to use `.claude/haios/lib/` for new loader

## Recommendation

Migration arc work item: Move `.claude/lib/*.py` to `.claude/haios/lib/` with:
1. Update all imports in `.claude/haios/modules/`
2. Update all imports in hooks, commands, skills
3. Leave compatibility shims in old location temporarily
4. Remove old location after verification

## References

- WORK-005 plan discussion (Session 219)
- Migration arc in E2.3
